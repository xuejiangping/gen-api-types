# get-api-types-2

#### ä»‹ç»

ğŸš€ ä¸€ä¸ªè‡ªåŠ¨ç”Ÿæˆè¯·æ±‚æ¥å£è¿”å›ç±»å‹çš„ cli å·¥å…·

åœ¨ ts é¡¹ç›®ä¸­ï¼Œç»å¸¸éœ€è¦ç¼–å†™æ¥å£è¿”å›ç±»å‹ã€‚ä½†æ˜¯æ¯æ¬¡éƒ½è¦æŸ¥çœ‹æ¥å£æ–‡æ¡£ï¼Œæ‰‹åŠ¨ç¼–å†™éå¸¸éº»çƒ¦ã€‚å¦‚æœé‡åˆ°ä¸€äº›ç¬¬ä¸‰æ–¹æ¥å£æˆ–è€…æ¥å£æ–‡æ¡£ä¸å…¨çš„æƒ…å†µï¼Œè¿˜éœ€è¦å…ˆè°ƒè¯•æ¥å£åï¼Œå†ç¼–å†™æ¥å£è¿”å›ç±»å‹ï¼Œå¾ˆä»¤äººå¤´ç–¼

å€ŸåŠ©è¿™ä¸ªå·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ ts è£…é¥°å™¨æ¥æ ‡è®°è¯·æ±‚æ¥å£çš„ç±»å’Œæ–¹æ³•ï¼Œç„¶ååŠ¨æ€è°ƒç”¨è¿™äº›æ¥å£ï¼Œå¹¶å°†æ¥å£è¿”å›çš„æ•°æ®è½¬æ¢æˆ ts ç±»å‹æ–‡ä»¶ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨é¡¹ç›®ä¸­ç›´æ¥ä½¿ç”¨äº†

> æ³¨æ„ï¼š
> è¯¥å·¥å…·éœ€è¦åŠ¨æ€æ‰§è¡Œ ts ä»£ç ï¼ˆåŠ¨æ€è°ƒç”¨é¡¹ç›®ä¸­çš„æ¥å£æ¨¡å—ï¼‰ï¼Œå¿…é¡»ä¾èµ– `tsx` æ‰§è¡Œå·¥å…·ï¼Œè¯·åŠ¡å¿…å…ˆå…¨å±€å®‰è£… `tsx`ï¼Œç¡®ä¿`tsx`å‘½ä»¤å¯ç”¨ã€‚

#### å®‰è£…æ•™ç¨‹

1.npm å®‰è£…

```shell
npm install tsx -g
npm install get-api-types-2 -D

```

#### ä½¿ç”¨è¯´æ˜

##### 1. ä½¿ç”¨è£…é¥°å™¨æ ‡è®°æ¥å£ç±»åå’Œæ–¹æ³•

```ts
import { gen_type_c, gen_type_m } from '../src'

@gen_type_c()
export class TestApi {
	@gen_type_m({ args: [100], typeName: 'XXX' })
	static async getList(id: number): Promise<XXX> {
		return asleep(1000).then(() => {
			return { name: 'zs', id }
		})
	}

	@gen_type_m()
	static getWeather(): Promise<Res_TestApi_getWeather> {
		return fetch('http://t.weather.sojson.com/api/weather/city/101030100').then(r => r.json())
	}
}
```

å¦‚ä¸Šé¢ä»£ç æ‰€ç¤º:

- `@gen_type_c`è£…é¥°å™¨å‡½æ•°ï¼Œç”¨æ¥æ ‡è®°æ¥å£ç±»ã€‚å› ä¸ºå·¥å…·ä¼šåŠ¨æ€åˆ†ææŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰ ts æ–‡ä»¶ï¼Œæ ‡è®°æ¥å£ç±»ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿå®šä½æ¥å£ç±»
- `@gen_type_m`è£…é¥°å™¨å‡½æ•°æ ‡è®°éœ€è¦è½¬æ¢çš„è¯·æ±‚æ–¹æ³•ã€‚å®ƒå¯ä»¥æ¥æ”¶ä¸€ä¸ªé…ç½®å¯¹è±¡ï¼ŒåŒ…å«ä¸¤ä¸ªå­—æ®µã€‚
  1.  `typeName: string` æ¥å£è¿”å›ç±»å‹åç§°ï¼Œè‹¥ä¸æŒ‡å®šè¯¥å­—æ®µï¼Œé»˜è®¤ç”Ÿæˆåç§°ä¸ºï¼š `Response_${ç±»å}_${æ–¹æ³•å}`
  2.  `argsï¼šany[] ` æ–¹æ³•å‚æ•°åˆ—è¡¨,å·¥å…·è°ƒç”¨è¯·æ±‚æ–¹æ³•æ—¶ï¼Œä¼šå°†å‚æ•°åˆ—è¡¨ä¼ å…¥è¯·æ±‚æ–¹æ³•

##### 2. æ‰§è¡Œå‘½ä»¤

```shell
npx gen-api-types-2  -o output_dir -O output_file_name ./api_dir1 ./api_dir2
```

å‚æ•°è¯´æ˜ï¼š

```shell
 Usage: npx gen-api-types-2 [options] [api_dirs...]

Options:
  -h, --help                  è¾“å‡ºå¸®åŠ©ä¿¡æ¯
  -r, --project_root <path>   é¡¹ç›®æ ¹ç›®å½•
  -o, --output_file <path>    è¾“å‡ºæ–‡ä»¶,é»˜è®¤index.d.ts
  -d, --output_dir <path>     è¾“å‡ºç›®å½•,é»˜è®¤å½“å‰æ ¹ç›®å½•
  -t, --ts_config_path <path> tsconfig.json æ–‡ä»¶è·¯å¾„
```

å½“ç„¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é…ç½® package.json ä¸­çš„ scripts æ¥ä½¿ç”¨

```json
{
	"scripts": {
		"gen_types": "gen-api-types-2 -o output_dir -O output_file_name ./api_dir1 ./api_dir2"
	}
}
```

å‘½ä»¤è¾“å‡ºï¼š

```shell
ğŸš€ å¼€å§‹ç”ŸæˆAPIç±»å‹...
sourceFilesGlob [ 'src\\**\\*.ts' ]
ğŸ“‹ å¤„ç† UserApi.getList ...
ğŸ“‹ å¤„ç† UserApi.getWeather ...
è¯·æ±‚ç»“æœï¼š
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ (index)        â”‚ Values                               â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ âœ”ï¸ successList â”‚ 'UserApi.getList UserApi.getWeather' â”‚
  â”‚ âŒ errorList   â”‚ ''                                   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
âœ… API ç±»å‹ç”Ÿæˆå®Œæˆ
```

##### 3. ä½¿ç”¨ç±»å‹

é»˜è®¤ç”Ÿæˆç±»å‹æ–‡ä»¶åä¸º index.d.ts,ä¸”æ²¡æœ‰å¯¼å‡º

```ts
type AAAA = { name: string };
type Response_UserApi_getWeather = {...}
```

å¯åœ¨`tsconfig.json`ä¸­é…ç½®`include`å¼•ç”¨æ–‡ä»¶,æˆ–è€…ç›´æ¥åœ¨æ¥å£æ¨¡å—æ–‡ä»¶é¡¶éƒ¨é€šè¿‡`/// <reference path="./index.d.ts" />`å¼•ç”¨
